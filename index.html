<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>MC weapon generate by CLOVER_creation</title>
  <style>
    body {
      background: #1b1b1b;
      color: #eee;
      font-family: sans-serif;
      padding: 2rem;
    }
    label {
      display: block;
      font-weight: bold;
      margin-top: 1rem;
    }
    input, button {
      width: 100%;
      padding: 0.6rem;
      margin-top: 0.5rem;
      background: #2c2c2c;
      border: 1px solid #555;
      color: #fff;
      font-size: 1rem;
    }
    button { cursor: pointer; }
    button:hover { background: #666; }

    /* ã‚­ãƒ£ãƒ³ãƒã‚¹ï¼‹ãƒ„ãƒ¼ãƒ«ãƒ‘ãƒãƒ«ã®æ¨ªä¸¦ã³ */
    .editor-container {
      display: flex;
      gap: 1rem;
      align-items: flex-start;
      margin-top: 1rem;
    }

    /* ãƒ„ãƒ¼ãƒ«ãƒ‘ãƒãƒ« */
    .tool-panel {
      width: 200px;
      background: #222;
      border: 1px solid #555;
      padding: 1rem;
      border-radius: 4px;
      box-sizing: border-box;
    }
    .tool-panel label {
      margin-top: 0;
      font-weight: normal;
    }
    .tool-panel input[type="color"],
    .tool-panel button {
      margin-top: 0.5rem;
    }

    /* ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤º */
    #modeStatus {
      text-align: center;
      background: #333;
      padding: 0.5rem;
      border-radius: 2px;
      font-weight: bold;
      margin-bottom: 1rem;
    }

    /* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒœã‚¿ãƒ³ */
    .tool-panel button.active {
      background: #666;
    }

    /* 16Ã—16 ã‚­ãƒ£ãƒ³ãƒã‚¹ï¼ˆæ‹¡å¤§è¡¨ç¤ºï¼‰ */
    #pixelCanvas {
      width: 800px;
      height: 800px;
      border: 1px solid #888;
      image-rendering: pixelated;
      background-color: #000;
      background-size: 40px 40px;
      background-image:
        linear-gradient(#333 1px, transparent 1px),
        linear-gradient(90deg, #333 1px, transparent 1px);
      cursor: crosshair;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>
<body>

<h1>MC weapon generate by CLOVER_creation</h1>

<label>ä½œæˆè€…åï¼ˆåŠè§’è‹±æ•°å­—ã®ã¿ã€ã‚¢ãƒ³ãƒ€ãƒ¼ãƒãƒ¼ãªã—ï¼‰</label>
<input id="author" pattern="[A-Za-z0-9]+" title="åŠè§’è‹±æ•°å­—ã®ã¿" placeholder="ä¾‹: MyName">

<label>æ­¦å™¨ã®IDï¼ˆåŠè§’è‹±æ•°å­—ã®ã¿ã€ã‚¢ãƒ³ãƒ€ãƒ¼ãƒãƒ¼ãªã—ï¼‰</label>
<input id="weapon" pattern="[A-Za-z0-9]+" title="åŠè§’è‹±æ•°å­—ã®ã¿" placeholder="ä¾‹: SuperSword">

<label>è¡¨ç¤ºåï¼ˆã™ã¹ã¦ã®è¨€èªå¯¾å¿œã€ç‰¹æ®Šæ–‡å­—ä¸å¯ï¼‰</label>
<input id="display" placeholder="ä¾‹: ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ–ãƒ¬ãƒ¼ãƒ‰">

<label>æ”»æ’ƒåŠ›</label>
<input id="damage" type="number" placeholder="ä¾‹: 10">

<label>ã‚¨ãƒ³ãƒãƒ£ãƒ³ãƒˆå¹¸é‹ç‡ï¼ˆ1ã€œ40ï¼‰</label>
<input id="enchant" type="number" placeholder="ä¾‹: 20">

<label>è€ä¹…å€¤ï¼ˆãƒ€ã‚¤ãƒ¤ã¯1550ãã‚‰ã„ï¼‰</label>
<input id="durability" type="number" placeholder="ä¾‹: 250">

<h3>æ­¦å™¨ç”»åƒã‚¨ãƒ‡ã‚£ã‚¿</h3>
<div class="editor-container">
  <!-- ãƒ„ãƒ¼ãƒ«ãƒ‘ãƒãƒ« -->
  <div class="tool-panel">
    <div id="modeStatus">ãƒ¢ãƒ¼ãƒ‰ï¼š<span id="modeLabel">æç”»ãƒ¢ãƒ¼ãƒ‰</span></div>
    <label for="colorPicker">è‰²ã‚’é¸æŠâ†“</label>
    <input type="color" id="colorPicker" value="#ff0000">
    <button id="btnDraw"   onclick="setMode('draw')">ğŸ–Œ æç”»</button>
    <button id="btnErase"  onclick="setMode('erase')">æ¶ˆã—ã‚´ãƒ </button>
    <button id="btnPicker" onclick="setMode('picker')">ã‚¹ãƒã‚¤ãƒˆ</button>
    <button onclick="clearCanvas()">å…¨ã‚¯ãƒªã‚¢</button>
  </div>
  <!-- ã‚­ãƒ£ãƒ³ãƒã‚¹ -->
  <canvas id="pixelCanvas" width="16" height="16"></canvas>
</div>

<label>ã‚¢ãƒ‰ã‚ªãƒ³ã®åå‰</label>
<input id="packname" placeholder="ä¾‹: Super Sword Pack">

<label>ã‚¢ãƒ‰ã‚ªãƒ³ã®èª¬æ˜æ–‡</label>
<input id="packdesc" placeholder="ä¾‹: Adds a super sword">

<h3>ãƒ“ãƒ˜ã‚¤ãƒ“ã‚¢ãƒ‘ãƒƒã‚¯ UUID</h3>
<label>header.uuid</label><input id="bhHeaderUUID" readonly>
<label>modules[].uuid</label><input id="bhModuleUUID" readonly>
<button onclick="genBH()">ãƒ“ãƒ˜ã‚¤ãƒ“ã‚¢UUIDã‚’ç”Ÿæˆï¼ˆå¿…é ˆï¼‰</button>

<h3>ãƒªã‚½ãƒ¼ã‚¹ãƒ‘ãƒƒã‚¯ UUID</h3>
<label>header.uuid</label><input id="rsHeaderUUID" readonly>
<label>modules[].uuid</label><input id="rsModuleUUID" readonly>
<button onclick="genRS()">ãƒªã‚½ãƒ¼ã‚¹UUIDã‚’ç”Ÿæˆï¼ˆå¿…é ˆï¼‰</button>

<button onclick="generate()">ã‚¢ãƒ‰ã‚ªãƒ³ç”Ÿæˆï¼†ä¿å­˜</button>

<script>
  const $ = id => document.getElementById(id);

  // UUIDç”Ÿæˆ
  function genBH() {
    $("bhHeaderUUID").value = crypto.randomUUID();
    $("bhModuleUUID").value = crypto.randomUUID();
  }
  function genRS() {
    $("rsHeaderUUID").value = crypto.randomUUID();
    $("rsModuleUUID").value = crypto.randomUUID();
  }
  genBH(); genRS();

  // ãƒ”ã‚¯ã‚»ãƒ«ã‚¨ãƒ‡ã‚£ã‚¿
  const canvas = $("pixelCanvas");
  const ctx    = canvas.getContext("2d");
  ctx.imageSmoothingEnabled = false;
  const colorPicker = $("colorPicker");
  let mode = "draw", isDrawing = false;

  const btnDraw   = $("btnDraw");
  const btnErase  = $("btnErase");
  const btnPicker = $("btnPicker");

  canvas.addEventListener("mousedown", () => isDrawing = true);
  canvas.addEventListener("mouseup",   () => isDrawing = false);
  canvas.addEventListener("mouseleave",() => isDrawing = false);
  canvas.addEventListener("mousemove", e => { if (isDrawing) drawAt(e); });
  canvas.addEventListener("click",     drawAt);

  function drawAt(e) {
    const rect = canvas.getBoundingClientRect();
    const x = Math.floor((e.clientX - rect.left) * (canvas.width  / rect.width));
    const y = Math.floor((e.clientY - rect.top ) * (canvas.height / rect.height));
    if (x<0||y<0||x>=16||y>=16) return;

    if (mode === "erase") {
      ctx.clearRect(x,y,1,1);
    }
    else if (mode === "picker") {
      const p = ctx.getImageData(x,y,1,1).data;
      const hex = "#" + p[0].toString(16).padStart(2,"0")
                    + p[1].toString(16).padStart(2,"0")
                    + p[2].toString(16).padStart(2,"0");
      colorPicker.value = hex;
      setMode("draw");
    }
    else {
      ctx.fillStyle = colorPicker.value;
      ctx.fillRect(x,y,1,1);
    }
  }

  function setMode(m) {
    mode = m;
    $("modeLabel").textContent =
      m==="draw"  ? "æç”»ãƒ¢ãƒ¼ãƒ‰" :
      m==="erase" ? "æ¶ˆã—ã‚´ãƒ ãƒ¢ãƒ¼ãƒ‰" :
                    "ã‚¹ãƒã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰";
    [btnDraw,btnErase,btnPicker].forEach(b => b.classList.remove("active"));
    (m==="draw"?btnDraw:m==="erase"?btnErase:btnPicker).classList.add("active");
  }
  setMode("draw");

  function clearCanvas() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
  }

  // .mcaddonç”Ÿæˆ
  async function generate() {
    const author   = $("author").value.trim();
    const weapon   = $("weapon").value.trim();
    const display  = $("display").value.trim();
    const damage   = parseInt($("damage").value);
    const enchant  = parseInt($("enchant").value);
    const durability = parseInt($("durability").value);
    const name     = $("packname").value.trim() || weapon;
    const desc     = $("packdesc").value.trim() || display;
    const bhHeader = $("bhHeaderUUID").value;
    const bhModule = $("bhModuleUUID").value;
    const rsHeader = $("rsHeaderUUID").value;
    const rsModule = $("rsModuleUUID").value;

    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    const alphaNum = /^[A-Za-z0-9]+$/;
    if (!author||!weapon||!display||
        isNaN(damage)||isNaN(enchant)||isNaN(durability)) {
      return alert("ã™ã¹ã¦ã®å…¥åŠ›ã‚’å®Œäº†ã—ã¦ãã ã•ã„ï¼");
    }
    if (!alphaNum.test(author)||!alphaNum.test(weapon)) {
      return alert("ä½œæˆè€…åã¨æ­¦å™¨IDã¯åŠè§’è‹±æ•°å­—ã®ã¿ã§ã™ã€‚");
    }
    if (enchant<1||enchant>40) {
      return alert("ã‚¨ãƒ³ãƒãƒ£ãƒ³ãƒˆé‹ã¯1ã€œ40ã§æŒ‡å®šã—ã¦ãã ã•ã„ã€‚");
    }

    const zip = new JSZip();

    // 1) pack_icon.png ã‚’è‡ªå‹•ãƒ­ãƒ¼ãƒ‰ã—ã¦ZIPãƒ«ãƒ¼ãƒˆã«é…ç½®
await fetch("pack_icon.png")
  .then(res => res.blob())
  .then(blob => {
    zip.folder("Behavior_Pack").file("pack_icon.png", blob);
    zip.folder("Resource_Pack").file("pack_icon.png", blob);
  });

    // 2) Behavior Pack: æ­¦å™¨å®šç¾©
    zip.file(`Behavior_Pack/items/${weapon}.item.json`, JSON.stringify({
      format_version: "1.20.50",
      "minecraft:item": {
        description: {
          identifier: `${author}:${weapon}`,
          menu_category: { category: "equipment", group: "itemGroup.name.sword" }
        },
        components: {
          "minecraft:max_stack_size": 1,
          "minecraft:icon": { texture: weapon },
          "minecraft:damage": damage,
          "minecraft:can_destroy_in_creative": false,
          "minecraft:hand_equipped": true,
          "minecraft:enchantable": { slot: "sword", value: enchant },
          "minecraft:durability": { max_durability: durability }
        }
      }
    }, null, 2));

    // 3) Resource Pack: ãƒ†ã‚¯ã‚¹ãƒãƒ£å®£è¨€
    zip.file(`Resource_Pack/textures/item_texture.json`, JSON.stringify({
      texture_data: { [weapon]: { textures: `textures/items/${weapon}.png` } }
    }, null, 2));

    // 4) Resource Pack: è¨€èªãƒ•ã‚¡ã‚¤ãƒ«
    zip.file(`Resource_Pack/texts/en_US.lang`,
      `item.${author}:${weapon}=${display}`);

    // 5) Behavior Pack: manifest.json
    zip.file(`Behavior_Pack/manifest.json`, JSON.stringify({
      format_version: 2,
      header: { name, description: desc, uuid: bhHeader, version: [1,0,0], min_engine_version: [1,20,0] },
      modules: [{ description: desc, type: "data", uuid: bhModule, version: [1,0,0] }]
    }, null, 2));

    // 6) Resource Pack: manifest.json
    zip.file(`Resource_Pack/manifest.json`, JSON.stringify({
      format_version: 2,
      header: { name, description: desc, uuid: rsHeader, version: [1,0,0], min_engine_version: [1,16,0] },
      modules: [{ description: desc, type: "resources", uuid: rsModule, version: [1,0,0] }]
    }, null, 2));

    // 7) æç”»ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ PNG ã«ã—ã¦è¿½åŠ 
    await new Promise(res => {
      canvas.toBlob(blob => {
        zip.file(`Resource_Pack/textures/items/${weapon}.png`, blob);
        res();
      }, "image/png");
    });

    // 8) ZIP ç”Ÿæˆï¼†ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
    zip.generateAsync({ type: "blob" }).then(blob => {
      saveAs(blob, `${weapon}.mcaddon`);
    });
  }
</script>

</body>

</html>
